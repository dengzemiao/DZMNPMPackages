function ExcelExport(e,d,t,r){var o;e&&e.length&&(o=[],e.forEach((e,s)=>{var a,n=[],t=e.columns||[],i=t.length,r=e.data||[],c=r.length,r=(t.every(e=>!e.name)||(a=[],t.forEach((e,t)=>{var r=Object.keys(e.style||{}),o=!1,l=(r.includes("supportTitle")&&(o=e.style.supportTitle),{}),r=(r.includes("colWidth")&&(l={colWidth:e.style.colWidth}),{data:e.name,style:o?e.style:l});(r=d?d(r,e.field,e,s,n.length,t,c,i):r)&&!r.hide&&a.push(r)}),n.push(a)),r.forEach(o=>{var l=[];t.forEach((e,t)=>{var r={data:GetColumnData(o,e.field),dataType:e.dataType,style:e.style||{}};(r=d?d(r,e.field,o,s,n.length,t,c,i):r)&&!r.hide&&l.push(r)}),n.push(l),ExcelExportChildren(n,t,o.children,d,s,c,i)}),{name:e.name,rows:n});o.push(r)}),ExcelExportManager(o,t,r))}function ExcelExportChildren(s,e,t,a,n,i,c){t=t||[];t.length&&t.forEach(o=>{var l=[];e.forEach((e,t)=>{var r={data:GetColumnData(o,e.field),dataType:e.dataType,style:e.style||{}};(r=a?a(r,e.field,o,n,s.length,t,i,c):r)&&!r.hide&&l.push(r)}),s.push(l),ExcelExportChildren(s,e,o.children,a,n,i,c)})}function GetColumnData(e,t){var r=void 0,o=t.split(".");if(1<o.length)for(var r=e,l=0;l<=o.length-1&&void 0!==(r=r[""+o[l]]);)l+=1;else r=e[t];return r}function ExcelExportManager(e,o,t){var l,r,c,s;e&&e.length&&(l=o||"",t=t||"xls",r=`
  <?xml version="1.0" encoding="UTF-8"?>
  <?mso-application progid= "Excel.Sheet"?>`,r+=`<Workbook
  xmlns="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:html="http://www.w3.org/TR/REC-html40">`,c=[],s=[],e.forEach((e,n)=>{o||(l+=e.name+(n?"-":""));var t=`<Worksheet ss:Name="${e.name}">`,i=(t+="<Table>",""),r="";e.rows.forEach((e,l)=>{var s="<Row>",a="";e.forEach((e,t)=>{0!==e.style.rowHeight&&!e.style.rowHeight||(s=`<Row ss:Height="${e.style.rowHeight}">`),0!==l||0!==e.style.colWidth&&!e.style.colWidth||(i+=`<Column ss:Index="${t+1}" ss:AutoFitWidth="0" ss:Width="${e.style.colWidth}"/>`);var t=`s${n}-${l}-`+t,r=e.dataType||typeof e.data,o=("Number"===(r="undefined"!==r?r.replace(r[0],r[0].toUpperCase()):r)&&1e10<e.data&&(r="String"),"Date"===e.dataType&&(r="String",e.data)&&(r="Number",e.data=EXDateNumber(e.data)),EXStyle(e,t)),o=(o&&c.push(o),EXCell(e,r,t,l));a+=o}),r=(r+=s)+a+"</Row>"}),t=t+i+r,s.push(t=t+"</Table>"+"</Worksheet>")}),c.length&&(r+="<Styles>",c.forEach(e=>{r+=e}),r+="</Styles>"),s.forEach(e=>{r+=e}),r+="</Workbook>",(e=document.createElement("a")).download=l+"."+t,t=new Blob([r]),e.href=URL.createObjectURL(t),e.click())}function EXStyle(e,t){var r=!1,o=e.style||{},l=Object.keys(o),t=`<Style ss:ID="${t}">`;if("Date"===e.dataType&&e.data&&(r=!0,t+='<NumberFormat ss:Format="Short Date"/>'),l.length){var e=l.includes("color"),s=l.includes("fontSize"),a=l.includes("fontName"),n=l.includes("fontBold"),i=l.includes("alignmentHor"),c=l.includes("alignmentVer"),d=l.includes("backgroundColor"),h=(h=l.includes("borderColor"))&&!!o.borderColor,u=(u=l.includes("borderWidth"))&&!!o.borderWidth,l=(l=l.includes("borderStyle"))&&!!o.borderStyle;if((e||s||a||n)&&(r=!0,$="<Font",a&&($+=` ss:FontName="${o.fontName}"`),$+=' x:CharSet="134"',s&&($+=` ss:Size="${o.fontSize}"`),e&&($+=` ss:Color="${o.color}"`),n&&($+=` ss:Bold="${o.fontBold}"`),t+=$+="/>"),(i||c)&&(r=!0,$="<Alignment",i&&($+=` ss:Horizontal="${o.alignmentHor}"`),c&&($+=` ss:Vertical="${o.alignmentVer}"`),t+=$+="/>"),d&&(r=!0,t+=`<Interior ss:Color="${o.backgroundColor}" ss:Pattern="Solid"/>`),h||u||l){r=!0;var m,f=""+(o.borderColor||"#000000"),p=""+(0===o.borderWidth?0:o.borderWidth||1),g=""+(o.borderPosition||"Left Top Right Bottom"),y=""+(o.borderStyle||"Continuous"),E=f.split(" "),x=p.split(" "),b=g.split(" "),v=y.split(" "),C=(1===E.length&&(E=[m=E[0],m,m,m]),1===x.length&&(x=[m=x[0],m,m,m]),1===v.length&&(v=[m=v[0],m,m,m]),Math.max(Math.min(E.length,x.length,b.length,v.length),0)),$="<Borders>";for(let e=0;e<C;e++)f=E[e],p=x[e],$+=`<Border ss:Position="${g=b[e]}" ss:LineStyle="${y=v[e]}" ss:Weight="${p}" ss:Color="${f}"/>`;t+=$+="</Borders>"}}return t+="</Style>",r?t:""}function EXCell(e,t,r,o){var l,s,a=e.style||{},r=`<Cell ss:StyleID="${r}"`;return Object.keys(a).includes("merges")&&(a=(a.merges||[]).find(e=>!e.row&&0!==Number(e.row)||Number(e.row)===o)||{})&&(l=(s=Object.keys(a)).includes("hor"),s=s.includes("ver"),l&&(r+=` ss:MergeAcross="${a.hor}"`),s)&&(r+=` ss:MergeDown="${a.ver}"`),r=(r=(r+=">")+`<Data ss:Type="${t||""}">`+(""+(e.data||"")))+"</Data>"+"</Cell>"}function EXDateNumber(e){var t;return e?(t=new Date("1900/01/01"),e=(e=(e=(e=(e=e.replaceAll("-","/")).replaceAll("~","/")).replaceAll("年","/")).replaceAll("月","/")).replaceAll("日",""),e=new Date(e),Math.floor((e-t)/1e3/60/60/24)+2):""}export{ExcelExport as ex,ExcelExport as write,ExcelExport as Export};