function ExcelExport(e,d,t,o){var r;e&&e.length&&(r=[],e.forEach((e,s)=>{var a=[],t=e.columns||[],n=t.length,o=e.data||[],i=o.length,c=[],o=(t.forEach((e,t)=>{var o=Object.keys(e.style||{}),r=!1,l=(o.includes("supportTitle")&&(r=e.style.supportTitle),{}),o=(o.includes("colWidth")&&(l={colWidth:e.style.colWidth}),{data:e.name,style:r?e.style:l});(o=d?d(o,e.field,e,s,a.length,t,i,n):o)&&!o.hide&&c.push(o)}),a.push(c),o.forEach(r=>{var l=[];t.forEach((e,t)=>{var o={data:GetColumnData(r,e.field),dataType:e.dataType,style:e.style||{}};(o=d?d(o,e.field,r,s,a.length,t,i,n):o)&&!o.hide&&l.push(o)}),a.push(l),ExcelExportChildren(a,t,r.children,d,s,i,n)}),{name:e.name,rows:a});r.push(o)}),ExcelExportManager(r,t,o))}function ExcelExportChildren(s,e,t,a,n,i,c){t=t||[];t.length&&t.forEach(r=>{var l=[];e.forEach((e,t)=>{var o={data:GetColumnData(r,e.field),dataType:e.dataType,style:e.style||{}};(o=a?a(o,e.field,r,n,s.length,t,i,c):o)&&!o.hide&&l.push(o)}),s.push(l),ExcelExportChildren(s,e,r.children,a,n,i,c)})}function GetColumnData(e,t){var o=void 0,r=t.split(".");if(1<r.length)for(var o=e,l=0;l<=r.length-1&&void 0!==(o=o[""+r[l]]);)l+=1;else o=e[t];return o}function ExcelExportManager(e,r,t){var l,o,c,s;e&&e.length&&(l=r||"",t=t||"xls",o=`
  <?xml version="1.0" encoding="UTF-8"?>
  <?mso-application progid= "Excel.Sheet"?>`,o+=`<Workbook
  xmlns="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:html="http://www.w3.org/TR/REC-html40">`,c=[],s=[],e.forEach((e,n)=>{r||(l+=e.name+(n?"-":""));var t=`<Worksheet ss:Name="${e.name}">`,i=(t+="<Table>",""),o="";e.rows.forEach((e,l)=>{var s="<Row>",a="";e.forEach((e,t)=>{0!==e.style.rowHeight&&!e.style.rowHeight||(s=`<Row ss:Height="${e.style.rowHeight}">`),0!==l||0!==e.style.colWidth&&!e.style.colWidth||(i+=`<Column ss:Index="${t+1}" ss:AutoFitWidth="0" ss:Width="${e.style.colWidth}"/>`);var t=`s${n}-${l}-`+t,o=e.dataType||typeof e.data,r=("Number"===(o="undefined"!==o?o.replace(o[0],o[0].toUpperCase()):o)&&1e10<e.data&&(o="String"),"Date"===e.dataType&&(o="String",e.data)&&(o="Number",e.data=EXDateNumber(e.data)),EXStyle(e,t)),r=(r&&c.push(r),EXCell(e,o,t,l));a+=r}),o=(o+=s)+a+"</Row>"}),t=t+i+o,s.push(t=t+"</Table>"+"</Worksheet>")}),c.length&&(o+="<Styles>",c.forEach(e=>{o+=e}),o+="</Styles>"),s.forEach(e=>{o+=e}),o+="</Workbook>",(e=document.createElement("a")).download=l+"."+t,t=new Blob([o]),e.href=URL.createObjectURL(t),e.click())}function EXStyle(e,t){var o=!1,r=e.style||{},l=Object.keys(r),t=`<Style ss:ID="${t}">`;if("Date"===e.dataType&&e.data&&(o=!0,t+='<NumberFormat ss:Format="Short Date"/>'),l.length){var e=l.includes("color"),s=l.includes("fontSize"),a=l.includes("fontName"),n=l.includes("fontBold"),i=l.includes("alignmentHor"),c=l.includes("alignmentVer"),d=l.includes("backgroundColor"),h=(h=l.includes("borderColor"))&&!!r.borderColor,u=(u=l.includes("borderWidth"))&&!!r.borderWidth,l=(l=l.includes("borderStyle"))&&!!r.borderStyle;if((e||s||a||n)&&(o=!0,$="<Font",a&&($+=` ss:FontName="${r.fontName}"`),$+=' x:CharSet="134"',s&&($+=` ss:Size="${r.fontSize}"`),e&&($+=` ss:Color="${r.color}"`),n&&($+=` ss:Bold="${r.fontBold}"`),t+=$+="/>"),(i||c)&&(o=!0,$="<Alignment",i&&($+=` ss:Horizontal="${r.alignmentHor}"`),c&&($+=` ss:Vertical="${r.alignmentVer}"`),t+=$+="/>"),d&&(o=!0,t+=`<Interior ss:Color="${r.backgroundColor}" ss:Pattern="Solid"/>`),h||u||l){o=!0;var m,f=""+(r.borderColor||"#000000"),p=""+(0===r.borderWidth?0:r.borderWidth||1),g=""+(r.borderPosition||"Left Top Right Bottom"),y=""+(r.borderStyle||"Continuous"),E=f.split(" "),x=p.split(" "),b=g.split(" "),v=y.split(" "),C=(1===E.length&&(E=[m=E[0],m,m,m]),1===x.length&&(x=[m=x[0],m,m,m]),1===v.length&&(v=[m=v[0],m,m,m]),Math.max(Math.min(E.length,x.length,b.length,v.length),0)),$="<Borders>";for(let e=0;e<C;e++)f=E[e],p=x[e],$+=`<Border ss:Position="${g=b[e]}" ss:LineStyle="${y=v[e]}" ss:Weight="${p}" ss:Color="${f}"/>`;t+=$+="</Borders>"}}return t+="</Style>",o?t:""}function EXCell(e,t,o,r){var l,s,a=e.style||{},o=`<Cell ss:StyleID="${o}"`;return Object.keys(a).includes("merges")&&(a=(a.merges||[]).find(e=>!e.row&&0!==Number(e.row)||Number(e.row)===r)||{})&&(l=(s=Object.keys(a)).includes("hor"),s=s.includes("ver"),l&&(o+=` ss:MergeAcross="${a.hor}"`),s)&&(o+=` ss:MergeDown="${a.ver}"`),o=(o=(o+=">")+`<Data ss:Type="${t||""}">`+(""+(e.data||"")))+"</Data>"+"</Cell>"}function EXDateNumber(e){var t;return e?(t=new Date("1900/01/01"),e=(e=(e=(e=(e=e.replaceAll("-","/")).replaceAll("~","/")).replaceAll("年","/")).replaceAll("月","/")).replaceAll("日",""),e=new Date(e),Math.floor((e-t)/1e3/60/60/24)+2):""}export{ExcelExport as ex,ExcelExport as write,ExcelExport as Export};